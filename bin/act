#!sh
# source this script with:
# . bin/act

if ! [ -f bin/act ]
then
    echo "Please source from top-level directory"
    exit 4
fi

OLD_PATH="$PATH"
bindir="$(pwd)/bin"
PATH="$bindir:$PATH"
OLD_PS1="$PS1"
PS1="!$(basename $(pwd))!$PS1"

# For each blah.m directory in bin, add a prefix command for it.
for d in $(ls -d "$bindir"/*.m 2>&-) ; do
    cmd="${d%.m}"
    cat > "$cmd" << EOF
#!/bin/sh
# $cmd
# Generic prefix command

PATH="\$(which $(basename "$cmd")).m":"\$PATH" "\$@"
EOF
    chmod +x "$cmd"
done

deact () {
    PATH="$OLD_PATH"
    PS1="$OLD_PS1"
}
